---
// index.astro - Homepage with masonry-style CSS Grid
// Displays all news articles in a 3-column responsive grid
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import NewsCard from "../components/NewsCard.astro";
import TagCloud from "../components/TagCloud.astro";

// Fetch all news articles
const allNews = await getCollection("news");

// Sort by date (newest first)
const sortedNews = allNews.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Extract all unique tags
const allTags = [...new Set(allNews.flatMap((news) => news.data.tags))];
---

<BaseLayout
  title="Game News - Latest Gaming News & Updates"
  description="Stay updated with the latest gaming news, reviews, and industry analysis"
>
  <div class="container">
    <!-- Hero Section -->
    <section class="hero">
      <h1>Latest Gaming News</h1>
      <p class="hero-subtitle">
        Stay informed with breaking news, in-depth reviews, and exclusive
        insights from the gaming world
      </p>
    </section>

    <!-- Main Layout: Tags (25%) + News (75%) -->
    <div class="main-layout">
      <!-- Sidebar: Tag Cloud -->
      <aside class="sidebar">
        <TagCloud tags={allTags} title="Explore Topics" />
      </aside>

      <!-- Main Content: News Grid -->
      <section class="news-section">
        <div class="news-grid">
          {sortedNews.map((news) => <NewsCard news={news} />)}
        </div>

        {
          sortedNews.length === 0 && (
            <p class="empty-state">No news articles found. Check back soon!</p>
          )
        }
      </section>
    </div>
  </div>
</BaseLayout>

<style>
  /* Hero Section */
  .hero {
    padding: var(--space-12) 0 var(--space-8);
    text-align: center;
    border-bottom: 2px solid var(--border-color);
    margin-bottom: var(--space-8);
  }

  .hero h1 {
    font-family: var(--font-serif);
    font-size: var(--text-5xl);
    font-weight: 900;
    line-height: 1.1;
    margin-bottom: var(--space-4);
    letter-spacing: -0.02em;
  }

  .hero-subtitle {
    font-size: var(--text-lg);
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Main Layout: Sidebar + Content */
  .main-layout {
    display: grid;
    grid-template-columns: 25% 75%;
    gap: var(--space-8);
    margin-bottom: var(--space-12);
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: calc(var(--header-height) + var(--space-4));
    height: fit-content;
  }

  /* News Section */
  .news-section {
    min-width: 0; /* Prevent grid overflow */
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: var(--space-16);
    font-size: var(--text-lg);
    color: var(--text-muted);
    font-style: italic;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .main-layout {
      grid-template-columns: 30% 70%;
      gap: var(--space-6);
    }
  }

  @media (max-width: 768px) {
    .hero {
      padding: var(--space-8) 0 var(--space-6);
    }

    .hero h1 {
      font-size: var(--text-3xl);
    }

    .hero-subtitle {
      font-size: var(--text-base);
    }

    .main-layout {
      grid-template-columns: 1fr;
      gap: var(--space-6);
    }

    .sidebar {
      position: static;
      order: 2;
    }

    .news-section {
      order: 1;
    }
  }
</style>
